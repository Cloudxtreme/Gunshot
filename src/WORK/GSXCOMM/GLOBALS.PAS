{$I DEFINES.INC}
UNIT Globals;


INTERFACE


USES ApPort,ApTimer,MkMsgAbs,Gunshot,MkFFile;


CONST DontSend               = #1#2#3;
CONST MaxMsgBuffer           = 48000;
CONST MaxMsgWidth            = 79;
CONST YappDelay              = 540;


TYPE BigQWKBuffer            = Array[1..MaxMsgBuffer] Of Char;
TYPE BSingle                 = Array [0..3] Of Byte;
TYPE BufferItem              = RECORD
     Token                   : String[80];
     Replacement             : String[100];
     END;
TYPE CC_Info                 = RECORD
     UserName                : String[30];
     END;
TYPE Comm_Msg                = RECORD
     UserName                : String[30];
     UserAlias               : String[30];
     Line                    : String[60];
     END;
TYPE FileDescriptions2       = Array[1..18] Of _FileDescriptions;
TYPE FileSearchIndexes       = RECORD
     Path                    : String[40];
     Area_Num                : Longint;
     Area_Sub                : Longint;
     Area_Name               : String[40];
     CD_Rom                  : Byte;
     END;
TYPE ListRecord              = RECORD
     MsgTo                   : String[30];
     MsgFrom                 : String[30];
     MsgSubject              : String[30];
     MsgPrivate              : Boolean;
     MsgRecv                 : Boolean;
     MsgNum                  : Word;
     END;
TYPE Menus                   = Array[1..150] Of _Menu_Record;
TYPE MessageTextLines        = RECORD
     Line                    : String[MaxMsgWidth];
     END;
TYPE Message_Header          = RECORD
     MsgNumber               : Longint;
     FirstText               : Longint;
     NumberText              : Longint;
     MsgFrom                 : String[78];
     MsgTo                   : String[78];
     MsgSubject              : String[78];
     MsgTime                 : Longint;
     MsgDate                 : String[6];
     SeeAlso                 : Longint;
     Reply                   : Longint;
     Local                   : Boolean;
     Echo                    : Boolean;
     Sent                    : Boolean;
     KillSent                : Boolean;
     Recv                    : Boolean;
     Priv                    : Boolean;
     Crash                   : Boolean;
     FileAttach              : Boolean;
     FileRequest             : Boolean;
     Delete                  : Boolean;
     Hold                    : Boolean;
     Dest                    : AddrType;
     Orig                    : AddrType;
     END;
TYPE Msg_Index               = Array[1..3000] Of Word;
TYPE Pager                   = RECORD
     UserName                : String[30];
     UserAlias               : String[30];
     Message                 : String[30];
     LineNumber              : Word;
     END;
TYPE QWKLastRead             = RECORD
     Area                    : String[51];
     Pointer                 : Word;
     DoReceived              : Boolean;
     DoPointer               : Boolean;
     MaxMsgs                 : Word;
     END;
TYPE QWK_Header              = RECORD
     MSGStatus               : Char;
     MSGNumber               : Array[1..7] Of Char;
     MSGDate                 : Array[1..8] Of Char;
     MSGTime                 : Array[1..5] Of Char;
     MSGTo                   : Array[1..25] Of Char;
     MSGFrom                 : Array[1..25] Of Char;
     MSGSubj                 : Array[1..25] Of Char;
     MSGPassword             : Array[1..12] Of Char;
     MSGReference            : Array[1..8] Of Char;
     MSGNumText              : Array[1..6] Of Char;
     MSGKilled               : Byte;
     MSGConf                 : Word;
     Spare1                  : Word;
     Spare2                  : Char;
     END;
TYPE QWK_Index               = RECORD
     Mks                     : BSingle;
     Scrap                   : Byte;
     END;
TYPE SaveScrn_AScreen        = Array[1..4000] Of Byte;
TYPE TaggedFileRecord        = RECORD
     FileName                : String[12];
     FilePath                : String[40];
     Size                    : Longint;
     CDRom                   : Boolean;
     Description             : String[25];
     FreeFile                : Boolean;
     FileArea                : Word;
     FileSub                 : Word;
     TransferOk              : Boolean;
     FileCPS                 : Longint;
     END;
TYPE Toggle_Info             = RECORD
     Total                   : Longint;
     Current                 : Longint;
     Percent                 : Byte;
     Active                  : Boolean;
     x1                      : Word;
     y1                      : Word;
     x2                      : Word;
     y2                      : Word;
     Colour                  : Byte;
     Horizontal              : Boolean;
     END;
TYPE Work_Buffer             = Array [1..50] Of BufferItem;


VAR  FArcDefs                : File Of _Archiver_Record;
     FBadLang                : File Of _BadLang_Record;
     FCallers                : File Of _Last10Callers_Record;
     FColours                : File Of _SysColourSVGA;
     FFileArea               : File Of _FileArea_Record;
     FFileArea2              : File Of _FileArea_Record;
     FFileDefs               : File Of _FileDefinitions;
     FFileDefs2              : File Of _FileDefinitions;
     FFileDesc               : File Of _FileDescriptions;
     FFileDesc2              : File Of _FileDescriptions;
     FFileSubs               : File Of _FileSub_Record;
     FLangDir                : File Of _LanguageDirs_Record;
     FLastUserOnline         : File Of _Lasthuman_Record;
     FMailerInfo             : File Of _Mailer_Record;
     FMessageArea            : File Of _MessageArea_Record;
     FMessageArea2           : File Of _MessageArea_Record;
     FMessageSubs            : File Of _MessageSub_Record;
     FNames                  : File Of _ScreenNames_Record;
     FNetWorkInfo            : File Of _Network_Record;
     FNewUserVGA             : File Of _NewUserVGA_Record;
     FNodeF                  : File Of _NodeFile_Record;
     FNodeF2                 : File Of _NodeFile_Record;
     FNodeInfo               : File Of _Node_Record;
     FOpening                : File Of _Opening_Record;
     FProtocolInfo           : File Of _Protocols_Record;
     FReports                : File Of _Report_Record;
     FScanners               : File Of _VirusScanners_Record;
     FShuttle                : File Of _Shuttle_Record;
     FSystemInfo             : File Of _SystemDat_Record;
     FTotals                 : File Of _SystemCalls_Record;
     FUserAccess             : File Of _Access_Record;
     FUserRecord             : File Of _UsersBBS_Record;
     FUUCP                   : File Of _UUCP_Record;
     FVerifier               : File Of _VerifyLog_Record;
     FCDRoms                 : File Of _CDRom_Record;
     FArcUtils               : File Of _Archiver_Utilities;
     FFreqs                  : File Of _FreqRecord;
     FRequestFile            : File Of _RequestFile;
     FNetOrigins             : File Of _Origin_Record;
     NetOrigins              : _Origin_Record;
     RequestFile             : _RequestFile;
     Freqs                   : _FreqRecord;
     ArcUtils                : _Archiver_Utilities;
     CDRoms                  : _CDRom_Record;
     ToggleCDRoms            : _CDRom_Record;
     ArcDefs                 : _Archiver_Record;
     BadLang                 : _BadLang_Record;
     Callers                 : Array[0..10] Of _Last10Callers_Record;
     Colours                 : _SysColourSVGA;
     FileAreas               : _FileArea_Record;
     FileAreas2              : _FileArea_Record;
     FileDefs                : _FileDefinitions;
     FileDefs2               : _FileDefinitions;
     FileSubs                : _FileSub_Record;
     LangDir                 : _LanguageDirs_Record;
     LastUserOnline          : _LastHuman_Record;
     MailerInfo              : _Mailer_Record;
     MessageAreas            : _MessageArea_Record;
     MessageAreas2           : _MessageArea_Record;
     MessageSubs             : _MessageSub_Record;
     Names                   : _ScreenNames_Record;
     NetWorkInfo             : _Network_Record;
     NewUserVGA              : _NewUserVGA_Record;
     NodeInfo                : _Node_Record;
     NodeInfo2               : _Node_Record;
     NodeF                   : _NodeFile_Record;
     Opening                 : _Opening_Record;
     ProtocolInfo            : _Protocols_Record;
     Reports                 : _Report_Record;
     Scanners                : _VirusScanners_Record;
     Shuttle                 : _Shuttle_Record;
     System_Info             : _SystemDat_Record;
     Totals                  : _SystemCalls_Record;
     UserAccess              : _Access_Record;
     UserRecord              : _UsersBBS_Record;
     UserRecord2             : ^_UsersBBS_Record;
     UUCP                    : _UUCP_Record;
     Verifier                : _VerifyLog_Record;
     CallerIdRecord          : _CallerId_Record;
     CIDSemaphore            : _CID_Data;
     FCIDSemaphore           : File Of _CID_Data;
     FCallerIdRecord         : File Of _CallerId_Record;
     PageUser                : Pager;
     FPageUser               : File Of Pager;
     FCarbonCopy             : File Of CC_Info;
     CarbonCopy              : CC_Info;
     FFileIndex              : File Of FileSearchIndexes;
     FileIndex               : FileSearchIndexes;
     FileDesc                : FileDescriptions2;
     FMsgText                : File Of MessageTextLines;
     FCommentToNext          : File Of COMM_MSG;
     CommentToNext           : COMM_MSG;
     Menu                    : ^Menus;
     ComString               : string[6];
     BaudString              : string[6];
     NodeNumber              : word;
     NodeString              : string[4];
     LockedBaudString        : string[6];
     Numeric                 : boolean;
     Loaded_Menu             : String[12];
     MenuActive              : Array[1..150] Of Boolean;
     redraw_menu             : boolean;
     new_user_number         : word;
     sysop_next              : boolean;
     TaggedFiles             : Array[1..15] Of TaggedFileRecord;
     tagged                  : byte;
     cps                     : word;
     do_download             : boolean;
     check_it                : boolean;
     user_name               : String[30];
     Menu_Count              : Word;
     user_pages              : byte;
     RealLastCall            : longint;
     ul_ratio                : longint;
     dl_ratio                : longint;
     use_alias               : Boolean;
     doing_logon             : Boolean;
     CurrentDrive            : Char;
     SuccessfulLogon         : Boolean;
     time_for_downloads      : Longint;
     Full_Day                : Longint;
     CurrentMessageArea      : word;
     CurrentMessageSub       : word;
     CurrentFileArea         : word;
     CurrentFileSub          : word;
     Gunshot_Directory       : String[40];
     DATA_Directory          : String[40];
     LANG_Directory          : String[40];
     MENU_Directory          : String[40];
     NEWS_Directory          : String[40];
     NODE_Directory          : String[40];
     HOLD_Directory          : String[40];
     SCAN_Directory          : String[40];
     BIN_Directory           : String[40];
     SIG_Directory           : String[40];
     CD_Directory            : String[40];
     SGDirectory             : String[40];
     SGXDirectory            : String[40];
     LanguageDirectory       : String[40];
     INTR_Directory          : String[40];
     DoingMainKeyPress       : Boolean;
     ChatChannel             : Word;
     PrivateChat             : Boolean;
     ChattingUsers           : Array[1..255] Of Boolean;
     AltKey                  : Boolean;
     ReplyingInitials        : String[10];
     LengthOfInitials        : Byte;
     DOOR_EXECUTED           : Boolean;
     FileUploadArea          : Word;
     FileUploadSub           : Word;
     LastMenuLoaded          : String[12];
     UseSignature            : Boolean;
     WorkBuffer              : Work_Buffer;
     InBuffer                : Word;
     CrapString              : String;
     Reserve                 : Array[1..150] Of Byte;
     CurCount                : Word;
     RunningMessageDL        : Word;
     RunningMessageFL        : Word;
     RunningMessageQWK       : Word;
     EnteredEcho             : Boolean;
     EnteredLocal            : Boolean;
     UsersTimeWarning        : Boolean;
     UsersTicker             : EventTimer;
     EventTimeWarning        : Boolean;
     EventMinutes            : Word;
     EventTicker             : EventTimer;
     BBSPort                 : PortRecPtr;
     ActualBaud              : Longint;
     RunTheChat              : Boolean;
     WaitingAtMenu           : Boolean;
     FixedLPT                : Byte;
     DidHeader               : Boolean;
     DidHeader2              : Boolean;
     DidMsgInfo              : Boolean;
     FileTransferSuccess     : Boolean;
     FileQueueList           : Array[1..15] Of String[60];
     FilesToSend             : Byte;
     AbortedProtocol         : Boolean;
     LastFilesBytesSent      : Longint;
     CurrentFileNum          : Word;
     ToggleInfo              : Toggle_Info;
     SavedTicker             : Longint;
     DialOutPort             : PortRecPtr;
     SessionErrors           : Longint;
     SavedCursorX            : Word;
     SavedCursorY            : Word;
     SAVESCRN_Scr2           : SAVESCRN_AScreen;
     LastActivity            : Word;
     FastBaseHdr             : Message_Header;
     MsgList                 : ListRecord;
     FMsgList                : File Of ListRecord;
     MsgIndex                : Msg_Index;
     CanKill                 : Boolean;
     CanSee                  : Boolean;
     IsYours                 : Boolean;
     CurrentMessageBase      : String[80];
     CurrentMessage          : Word;
     TotalMessages           : Word;
     UserLastReadMsg         : Word;
     HighMsgNumber           : Word;
     Msg_File_Request        : Boolean;
     Msg_File_Attach         : Boolean;
     Msg_Crash               : Boolean;
     Msg_Hold                : Boolean;
     EnteredReply            : Boolean;
     Msg                     : AbsMsgPtr;
     OrigAddr                : AddrType;
     DestAddr                : AddrType;
     QWKIndex                : QWK_Index;
     FQWKIndex               : File Of QWK_Index;
     QWKAreasFound           : Word;
     Control_Dat             : Text;
     Messages_Dat            : File;
     QWKHeaders              : QWK_Header;
     QWKTextBuffer           : ^BigQWKBuffer;
     QWKLastReads            : QWKLastRead;
     FQWKLastReads           : File Of QWKLastRead;
     HighestQWKPointer       : Word;
     REPPacket               : String;
     SavedTop                : Word;
     WeAbort                 : Boolean;
     DoQuickLogon            : Boolean;
     User_Paged              : Boolean;
     CarrierTimer            : EventTimer;
     ReplyDomain             : String[60];
     BigCrap                 : Longint;
     TBufferedFile           : FFileObj;
     RemoteYappVersion       : Word;
     SwappingMethod          : Integer;
     NodeListSystem          : String[40];


IMPLEMENTATION


BEGIN
     NewTimerSecs(CarrierTimer,4);
     RunningMessageDL := 1;
END.
